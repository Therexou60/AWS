# üöÄ Challenge "AWS IAM Access Analyzer" : Analyse des Permissions et S√©curit√© IAM

## üìå Contexte
En tant qu'administrateur AWS, vous devez auditer et s√©curiser les permissions de vos ressources dans un environnement AWS. Vous utiliserez AWS IAM Access Analyzer pour identifier les autorisations excessives ou mal configur√©es et prendre des mesures correctives afin de garantir une s√©curit√© optimale.

### üîß Services AWS potentiellement utilis√©s
- **AWS IAM Access Analyzer**
- **AWS IAM**
- **AWS S3**
- **AWS CloudTrail**
- **AWS Config**

---

## ‚úÖ Solution 1 : Utilisation d'AWS IAM Access Analyzer pour analyser les permissions

### üèóÔ∏è √âtapes d√©taill√©es

1. **Activer Access Analyzer**
   - Acc√©dez √† la console IAM ‚Üí "Access Analyzer" ‚Üí "Create analyzer".
   - Configurez :
     - Nom de l'analyseur.
     - R√©gion.
     - Type d'analyse : **Account** (pour analyser toutes les ressources du compte).

2. **Analyser les ressources partag√©es**
   - Une fois l'analyseur activ√©, attendez que les r√©sultats apparaissent.
   - Identifiez les ressources avec des autorisations partag√©es publiques ou crois√©es avec d'autres comptes AWS.
   - Exemple de ressources analys√©es :
     - Buckets S3.
     - KMS Keys.
     - R√¥les IAM.

3. **√âvaluer les findings (r√©sultats)**
   - Dans "Findings", examinez chaque ressource signal√©e :
     - V√©rifiez les autorisations publiques non intentionnelles.
     - V√©rifiez les partages inter-comptes.
   - Exemple de r√©sultat :
     - Un bucket S3 est accessible publiquement via "s3:GetObject".

4. **Corriger les autorisations excessives**
   - Pour chaque finding :
     - Modifiez les politiques IAM ou S3 pour restreindre l'acc√®s.
     - Exemple pour un bucket S3 :

       ```json
       {
         "Version": "2012-10-17",
         "Statement": [
           {
             "Effect": "Deny",
             "Principal": "*",
             "Action": "s3:GetObject",
             "Resource": "arn:aws:s3:::example-bucket/*",
             "Condition": {
               "IpAddress": {
                 "aws:SourceIp": "192.168.0.0/24"
               }
             }
           }
         ]
       }
       ```

5. **Activer les logs pour surveiller les modifications**
   - Configurez AWS CloudTrail pour capturer les √©v√©nements IAM.
   - Activez les logs Access Analyzer pour suivre les findings corrig√©s et les changements futurs.

---

## ‚úÖ Solution 2 : Surveillance proactive avec AWS Config et Access Analyzer

### üèóÔ∏è √âtapes d√©taill√©es

1. **Activer AWS Config**
   - Acc√©dez √† la console AWS Config ‚Üí "Settings".
   - Activez la surveillance des ressources IAM, S3, KMS, etc.
   - Cr√©ez des r√®gles AWS Config pour v√©rifier les meilleures pratiques :
     - Exemple : `s3-bucket-public-read-prohibited`.

2. **Int√©grer AWS Config avec Access Analyzer**
   - Configurez une r√®gle Config personnalis√©e pour v√©rifier que toutes les findings d'Access Analyzer sont r√©solues.
   - Recevez des notifications via Amazon SNS en cas de findings non corrig√©s.

3. **Configurer des alarmes CloudWatch**
   - Cr√©ez une alarme CloudWatch pour surveiller les activit√©s suspectes d√©tect√©es par Access Analyzer.
   - Exemple : Alarme bas√©e sur un taux √©lev√© de findings critiques.

4. **Mettre en place des alertes automatis√©es avec Lambda**
   - Cr√©ez une fonction AWS Lambda d√©clench√©e par les findings d'Access Analyzer.
   - Exemple : Si une ressource devient publique, envoyer une alerte et appliquer une politique corrective automatiquement.

---

## üîÑ Alternatives et solutions suppl√©mentaires

1. **Utiliser des strat√©gies bas√©es sur les balises**
   - Appliquez des politiques IAM qui limitent l'acc√®s en fonction des balises attribu√©es aux ressources.

2. **Activer Amazon Macie pour une analyse approfondie des donn√©es S3**
   - Identifier les donn√©es sensibles et v√©rifier qu'elles ne sont pas expos√©es publiquement.

3. **Cr√©er des workflows Step Functions pour la rem√©diation**
   - Automatiser les actions correctives pour les findings critiques d'Access Analyzer.

4. **Limiter les acc√®s √† l'aide d'ABAC (Attribute-Based Access Control)**
   - Cr√©ez des politiques IAM dynamiques bas√©es sur des attributs utilisateur.


# ACCESS DENIED: AWS IAM ACCESS ANALYZER


## üöÄ Solution 1 : Utilisation de IAM Access Analyzer

### üèóÔ∏è √âtapes √† suivre

1. **Acc√©der √† IAM Access Analyzer**
   - Aller dans la console AWS ‚Üí IAM
   - S√©lectionner **Access Analyzer** dans le menu lat√©ral
   - V√©rifier si un analyseur est d√©j√† configur√©, sinon en cr√©er un

2. **Lancer une analyse des acc√®s**
   - V√©rifier les findings (r√©sultats) g√©n√©r√©s par l'analyseur
   - Rechercher les findings li√©s aux **S3 buckets**
   - Identifier les politiques (policies) qui autorisent un acc√®s externe

3. **Corriger les permissions S3**
   - Aller dans la console AWS ‚Üí S3
   - S√©lectionner le bucket concern√©
   - V√©rifier l‚Äôonglet "Permissions"
   - Modifier ou supprimer les policy statements trop permissives
   - D√©sactiver l‚Äôacc√®s public si n√©cessaire

4. **Tester et valider les corrections**
   - Relancer une analyse avec IAM Access Analyzer
   - V√©rifier que les findings ont √©t√© r√©solus

---

## üõ†Ô∏è Solution 2 : Utilisation de S3 Block Public Access et Bucket Policies

### üèóÔ∏è √âtapes √† suivre

1. **V√©rifier l‚Äô√©tat du bucket S3**
   - Aller dans AWS S3
   - S√©lectionner le bucket concern√©
   - V√©rifier la section "Block Public Access"

2. **Activer S3 Block Public Access**
   - Activer l‚Äôoption **Block all public access**
   - Sauvegarder les modifications

3. **Modifier les Bucket Policies**
   - Aller dans l‚Äôonglet "Permissions"
   - Modifier la bucket policy pour restreindre l‚Äôacc√®s aux comptes AWS de confiance uniquement
   - Exemple de policy restrictive :
   
   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Deny",
         "Principal": "*",
         "Action": "s3:*",
         "Resource": "arn:aws:s3:::example-bucket/*",
         "Condition": {
           "StringNotEquals": {
             "aws:PrincipalAccount": "123456789012"
           }
         }
       }
     ]
   }
   ```

4. **Revalider avec IAM Access Analyzer**
   - Relancer l‚Äôanalyse pour s‚Äôassurer que les acc√®s externes ont √©t√© supprim√©s

---

## üèóÔ∏è Solutions Alternatives

1. **AWS Config pour surveiller les changements de permissions**
   - Configurer AWS Config pour d√©tecter et signaler les changements anormaux des policies S3

2. **CloudTrail pour analyser l‚Äôhistorique des acc√®s**
   - V√©rifier avec AWS CloudTrail quels utilisateurs ou services ont acc√©d√© aux S3 buckets

3. **GuardDuty pour identifier des comportements suspects**
   - Utiliser AWS GuardDuty pour d√©tecter des acc√®s anormaux et des menaces potentielles

4. **AWS SCP (Service Control Policies) pour restreindre les acc√®s globaux**
   - Si n√©cessaire, utiliser **AWS Organizations** pour appliquer des restrictions globales sur les acc√®s aux ressources sensibles

